<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <title>tWaitForFile</title><link rel="stylesheet" type="text/css" href="../css/talend_components_eclipse.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><meta name="keywords" content="twaitforfile, directory_iteration, file_iteration, file_operation_based_trigger"><link rel="home" href="bk-components-rg-fr..html" title="Composants Talend"><link rel="up" href="ch-orchestration.html" title="Chapitre&nbsp;19.&nbsp;Composants Orchestration"><link rel="prev" href="tSleep.html" title="tSleep"><link rel="next" href="tWaitForSocket.html" title="tWaitForSocket"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">tWaitForFile</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="tSleep.html">Pr&eacute;c&eacute;dent</a>&nbsp;</td><th width="60%" align="center">Chapitre&nbsp;19.&nbsp;Composants Orchestration</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="tWaitForSocket.html">Suivant</a></td></tr></table><hr></div><div lang="fr" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tWaitForFile"></a>tWaitForFile</h2></div></div></div><div class="mediaobject"><img src="../images/tWaitForFile_icon32_white.png"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d84597e560759"></a>Propri&eacute;t&eacute;s du tWaitForFile</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><tbody><tr><td valign="top"><p><span class="emphasis"><strong>Famille de
                                    composant</strong></span></p>
                        </td><td valign="top"><p>Orchestration</p>
                        </td><td valign="top">&nbsp;</td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Fonction</strong></span></p>
                        </td><td colspan="2" valign="top"><p>Le composant <span class="emphasis"><strong>tWaitForFile</strong></span> fait une boucle sur un r&eacute;pertoire
                                donn&eacute; et d&eacute;clenche le composant suivant lorsque la condition d&eacute;finie
                                est rencontr&eacute;e.</p>
                        </td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Objectif</strong></span></p>
                        </td><td colspan="2" valign="top"><p>Ce composant est utilis&eacute; pour mettre en attente le composant li&eacute;. Il d&eacute;clenche ce composant
                                lorsque l'op&eacute;ration sur le fichier d&eacute;fini est effectu&eacute;e dans le
                                r&eacute;pertoire sp&eacute;cifi&eacute;.</p>
                        </td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Basic
                                settings</strong></span></p>
                        </td><td valign="top"><p><span class="emphasis"><em>Time (in seconds) between
                                    iterations</em></span></p>
                        </td><td valign="top"><p>Param&eacute;trez l'intervalle de temps entre deux it&eacute;rations (en secondes).</p>
                        </td></tr><tr><td><p>&nbsp;</p>
                        </td><td valign="top"><p><span class="emphasis"><em>Max. number of iterations (infinite loop
                                    if empty)</em></span></p>
                        </td><td valign="top"><p>Configurez le nombre maximal d'it&eacute;rations &agrave; effectuer sur le r&eacute;pertoire sp&eacute;cifi&eacute;.</p>
                        </td></tr><tr><td><p>&nbsp;</p>
                        </td><td valign="top"><p><span class="emphasis"><em>Directory to scan</em></span></p>
                        </td><td valign="top"><p>Sp&eacute;cifiez le r&eacute;pertoire sur lequel effectuer des it&eacute;rations.</p>
                        </td></tr><tr><td><p>&nbsp;</p>
                        </td><td valign="top"><p><span class="emphasis"><em>File mask</em></span></p>
                        </td><td valign="top"><p>Saisissez le masque du fichier recherch&eacute; afin de filtrer les fichiers &agrave; monitorer. Pour
                                monitorer un fichier, saisissez son nom.</p>
                        </td></tr><tr><td><p>&nbsp;</p>
                        </td><td valign="top"><p><span class="emphasis"><em>Include subdirectories</em></span></p>
                        </td><td valign="top"><p>Cochez cette case pour inclure les sous-r&eacute;pertoires dans l'it&eacute;ration.</p>
                        </td></tr><tr><td><p>&nbsp;</p>
                        </td><td valign="top"><p><span class="emphasis"><em>Case sensitive</em></span></p>
                        </td><td valign="top"><p>Cochez cette case pour tenir compte de la
                                casse.</p>
                        </td></tr><tr><td><p>&nbsp;</p>
                        </td><td valign="top"><p><span class="emphasis"><em>Include present file</em></span></p>
                        </td><td valign="top"><p>Cochez cette case pour inclure le fichier
                                courant.</p>
                        </td></tr><tr><td><p>&nbsp;</p>
                        </td><td valign="top"><p><span class="emphasis"><em>Trigger action when </em></span></p>
                        </td><td valign="top"><p>S&eacute;lectionnez l'une des conditions de d&eacute;clenchement&nbsp;:</p><p><span class="emphasis"><strong>a file is created</strong></span>&nbsp;: d&eacute;clenche le composant suivant lorsqu'un
                                fichier est cr&eacute;&eacute;.</p><p><span class="emphasis"><strong>a file is deleted</strong></span>&nbsp;: d&eacute;clenche le composant suivant lorsqu'un
                                fichier est supprim&eacute;.</p><p><span class="emphasis"><strong>a file is updated</strong></span>&nbsp;: d&eacute;clenche le composant suivant lorsqu'un
                                fichier est modifi&eacute;.</p><p><span class="emphasis"><strong>a file is created or updated or deleted</strong></span>&nbsp;: d&eacute;clenche le
                                composant suivant lorsqu'un fichier est cr&eacute;&eacute;, supprim&eacute; ou
                                modifi&eacute;.</p>
                        </td></tr><tr><td><p>&nbsp;</p>
                        </td><td valign="top"><p><span class="emphasis"><em>Then</em></span></p>
                        </td><td valign="top"><p>S&eacute;lectionnez l'action &agrave; effectuer avec la boucle it&eacute;rative apr&egrave;s d&eacute;clenchement du composant
                                suivant&nbsp;: </p>
                            <p>- <span class="emphasis"><strong>continue loop</strong></span> : continuer
                                l'it&eacute;ration jusqu'&agrave; ce que le nombre maximum d'it&eacute;rations soit
                                atteint.</p>
                            <p>- <span class="emphasis"><strong>exit loop</strong></span> : arr&ecirc;ter l'it&eacute;ration
                                imm&eacute;diatement.</p>
                        </td></tr><tr><td><p>&nbsp;</p>
                        </td><td valign="top"><p><span class="emphasis"><em>Schema</em></span> et <span class="emphasis"><em>Edit
                                    Schema</em></span></p>
                        </td><td valign="top"><p>Un sch&eacute;ma est une description de lignes, il d&eacute;finit le nombre de champs qui sont trait&eacute;s et
                                pass&eacute;s au composant suivant. Le sch&eacute;ma de ce composant est local
                                (built-in) et ne peut &ecirc;tre modifi&eacute;.</p>
                            
                        </td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Advanced
                                settings</strong></span></p>
                        </td><td valign="top"><p><span class="emphasis"><em>Wait for file to be released Every (in ms)</em></span></p>
                        </td><td valign="top"><p>Cochez cette case afin que le composant suivant ne se d&eacute;clenche qu'apr&egrave;s la fin de
                                l'op&eacute;ration.</p>
                        </td></tr><tr><td valign="top">
                            <p><span class="emphasis"><strong>Global Variables</strong></span></p>
                        </td><td colspan="2" valign="top">
                            <p><span class="emphasis"><strong>ERROR_MESSAGE</strong></span> : message d'erreur g&eacute;n&eacute;r&eacute; par le composant
		lorsqu'une erreur survient. Cette variable est une variable <span class="emphasis"><strong>After</strong></span> et retourne une cha&icirc;ne de caract&egrave;res. Cette variable fonctionne
		uniquement si la case <span class="emphasis"><strong>Die on error</strong></span> est d&eacute;coch&eacute;e, si le
		composant a cette option.</p>
                            <p><span class="emphasis"><strong>CURRENT_ITERATION</strong></span> : num&eacute;ro de s&eacute;quence de l'it&eacute;ration
		courante. Cette variable est une variable <span class="emphasis"><strong>Flow</strong></span> et retourne
		un entier.</p>
                            <p><span class="emphasis"><strong>PRESENT_FILE</strong></span> : nom et chemin d'acc&egrave;s au fichier. Cette
		variable est une variable <span class="emphasis"><strong>Flow</strong></span> et retourne une cha&icirc;ne de
		caract&egrave;res.</p>
                            <p><span class="emphasis"><strong>DELETED_FILE</strong></span> : nom et chemin d'acc&egrave;s au fichier supprim&eacute;.
		Cette variable est une variable <span class="emphasis"><strong>Flow</strong></span> et retourne une cha&icirc;ne
		de caract&egrave;res.</p>
                            <p><span class="emphasis"><strong>CREATED_FILE</strong></span> : nom et chemin d'acc&egrave;s au fichier cr&eacute;&eacute;.
		Cette variable est une variable <span class="emphasis"><strong>Flow</strong></span> et retourne une cha&icirc;ne
		de caract&egrave;res.</p>
                            <p><span class="emphasis"><strong>UPDATED_FILE</strong></span> : nom et chemin d'acc&egrave;s au fichier mis &agrave;
		jour. Cette variable est une variable <span class="emphasis"><strong>Flow</strong></span> et retourne une
		cha&icirc;ne de caract&egrave;res.</p>
                            <p><span class="emphasis"><strong>FILENAME</strong></span> : nom du fichier trait&eacute;. Cette variable est une
		variable <span class="emphasis"><strong>Flow</strong></span> et retourne une cha&icirc;ne de caract&egrave;res.</p>
                            <p><span class="emphasis"><strong>NOT_UPDATED_FILE</strong></span> : nom et chemin d'acc&egrave;s au fichier
		n'ayant pas &eacute;t&eacute; mis &agrave; jour. Cette variable est une variable <span class="emphasis"><strong>Flow</strong></span> et retourne une cha&icirc;ne de caract&egrave;res.</p>
                            <p>Une variable <span class="emphasis"><strong>Flow</strong></span> fonctionne durant l'ex&eacute;cution d'un
		composant. Une variable <span class="emphasis"><strong>After</strong></span> fonctionne apr&egrave;s l'ex&eacute;cution
		d'un composant.</p>
                            <p>Pour renseigner un champ ou une expression &agrave; l'aide d'une variable, appuyez sur les
		touches <span class="emphasis"><strong>Ctrl+Espace</strong></span> pour acc&eacute;der &agrave; la liste des variables.
		A partir de cette liste, vous pouvez choisir la variable que vous souhaitez utiliser. </p>
                            <p> Pour plus d'informations concernant les variables, consultez le <span class="emphasis"><em>Guide utilisateur du</em></span>
		<span class="emphasis"><em>Studio Talend</em></span>.</p>
                        </td></tr><tr><td valign="top">
                            <p><span class="emphasis"><strong>Utilisation</strong></span></p>
                        </td><td colspan="2" valign="top">
                            <p>Ce composant est un composant de d&eacute;clenchement du composant
                                suivant, en fonction de la condition &eacute;tablie. Ainsi, ce composant
                                doit &ecirc;tre connect&eacute; &agrave; un autre composant.</p>
                        </td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Connections</strong></span></p>
                        </td><td><p>&nbsp;</p>
                        </td><td valign="top"><p>Liens de sortie (de ce composant &agrave; un autre)&nbsp;:</p><p><span class="emphasis"><strong>Row</strong></span>&nbsp;: Main, Iterate.</p><p><span class="emphasis"><strong>Trigger</strong></span>&nbsp;: OnSubjobOk, Run if, OnComponentOk,
                                OnComponentError.</p><p> </p><p>Liens d'entr&eacute;e (d'un autre composant &agrave; celui-ci)&nbsp;:</p><p><span class="emphasis"><strong>Row</strong></span>&nbsp;: Iterate.</p><p><span class="emphasis"><strong>Trigger</strong></span>&nbsp;: OnSubjobOk, Run if, OnComponentOk,
                                OnComponentError, Synchronize, Parallelize. </p><p> </p><p>Pour plus d'informations concernant les liens, consultez le <span class="emphasis"><em>Guide
                                    utilisateur du Studio Talend</em></span>.</p>
                        </td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Log4j</strong></span></p></td><td colspan="2" valign="top"><p>L'activit&eacute; de ce composant peut &ecirc;tre journalis&eacute;e avec la fonctionnalit&eacute; <span class="emphasis"><em>log4j</em></span>. Pour plus d'informations sur cette fonctionnalit&eacute;,
        consultez le <span class="emphasis"><em>Guide utilisateur du Studio Talend</em></span>.</p><p>Pour plus d'informations sur les niveaux de logs du log4j, consultez la documentation
        d'Apache : <a class="link" href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/Level.html" target="_top">http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/Level.html</a> (en
        anglais).</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="scenario1"></a>Sc&eacute;nario 1 : Attendre la cr&eacute;ation d'un fichier et arr&ecirc;ter l'it&eacute;ration apr&egrave;s le
            d&eacute;clenchement d'un message</h3></div></div></div><p>Ce sc&eacute;nario d&eacute;crit un Job scannant un r&eacute;pertoire et d&eacute;clenchant un message affichant
            dans la console les informations de cr&eacute;ation d'un fichier lorsqu'un fichier texte est
            cr&eacute;&eacute; dans ce r&eacute;pertoire. Le scan prend fin et un autre message affiche le nombre
            d'it&eacute;rations termin&eacute;es. </p><div class="mediaobject"><img src="../images/Use_Case_tWaitForFile1.png"></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d84597e561169"></a>Construire le Job</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Glissez-d&eacute;posez trois composants de la <span class="emphasis"><strong>Palette</strong></span> dans l'espace de mod&eacute;lisation graphique : un
                            <span class="emphasis"><strong>tWaitForFile</strong></span> et deux composants
                            <span class="emphasis"><strong>tJava</strong></span>.</p></li><li class="step"><p>Reliez le <span class="emphasis"><strong>tWaitForFile</strong></span> au premier
                            <span class="emphasis"><strong>tJava</strong></span> &agrave; l'aide d'un lien <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Iterate</strong></span>.</p></li><li class="step"><p>Reliez le <span class="emphasis"><strong>tWaitForFile</strong></span> au second
                            <span class="emphasis"><strong>tJava</strong></span> &agrave; l'aide d'un lien <span class="emphasis"><strong>Trigger</strong></span> &gt; <span class="emphasis"><strong>On Subjob
                            Ok</strong></span>.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d84597e561215"></a>Configurer les composants</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Double-cliquez sur le <span class="emphasis"><strong>tWaitForFile</strong></span> pour
                        ouvrir sa vue <span class="emphasis"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/Use_Case_tWaitForFile2.png"></div></li><li class="step"><p>Dans le champ <span class="emphasis"><strong>Directory to scan</strong></span>,
                        saisissez le nom du r&eacute;pertoire &agrave; scanner.</p></li><li class="step"><p>Dans le champ <span class="emphasis"><strong>File mask</strong></span>, saisissez
                            <span class="emphasis"><em>"*.txt"</em></span> pour scanner uniquement les
                        fichiers texte.</p></li><li class="step"><p>Dans la liste d&eacute;roulante <span class="emphasis"><strong>Trigger action
                            when</strong></span>, s&eacute;lectionnez <span class="emphasis"><strong>a file is
                            created</strong></span> afin de d&eacute;clencher le premier <span class="emphasis"><strong>tJava</strong></span> lorsqu'un fichier texte est cr&eacute;&eacute;.</p></li><li class="step"><p>Dans la liste d&eacute;roulante <span class="emphasis"><strong>Then</strong></span>,
                        s&eacute;lectionnez <span class="emphasis"><strong>exit loop</strong></span> afin d'arr&ecirc;ter la
                        boucle it&eacute;rative d&egrave;s que le premier <span class="emphasis"><strong>tJava</strong></span> a
                        &eacute;t&eacute; d&eacute;clench&eacute;.</p></li><li class="step"><p>Double-cliquez sur le premier <span class="emphasis"><strong>tJava</strong></span> pour
                        ouvrir sa vue <span class="emphasis"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/Use_Case_tWaitForFile3.png"></div></li><li class="step"><p>Dans le champ <span class="emphasis"><strong>Code</strong></span>, saisissez le code
                        suivant
                        :</p><pre class="programlisting">System.out.println("A file was created at " + TalendDate.getCurrentDate());
System.out.println("Name of the created file: " + ((String)globalMap.get("tWaitForFile_1_CREATED_FILE")));</pre></li><li class="step"><p>Double-cliquez sur le second <span class="emphasis"><strong>tJava</strong></span> pour
                        ouvrir sa vue <span class="emphasis"><strong>Basic settings</strong></span>.</p></li><li class="step"><p>Dans le champ <span class="emphasis"><strong>code</strong></span>, saisissez le code
                        suivant
                        :</p><pre class="programlisting">System.out.println("\r\nIteration loop ended at " + TalendDate.getCurrentDate());
System.out.println("Number of iterations finished: " +  ((Integer)globalMap.get("tWaitForFile_1_CURRENT_ITERATION")));</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d84597e561307"></a>Sauvegarder et ex&eacute;cuter le Job</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Appuyez sur les touches <span class="emphasis"><strong>Ctrl+S</strong></span> pour
                        sauvegarder le Job.</p></li><li class="step"><p>Appuyez sur <span class="emphasis"><strong>F6</strong></span> pour ex&eacute;cuter le
                        Job.</p></li><li class="step"><p>Cr&eacute;ez un fichier texte <span class="emphasis"><em>exit.txt</em></span> dans le
                        r&eacute;pertoire sp&eacute;cifi&eacute;.</p><div class="mediaobject"><img src="../images/Use_Case_tWaitForFile4.png"></div><p>Lorsqu'un fichier texte est cr&eacute;&eacute;, un message concernant la cr&eacute;ation du
                        fichier appara&icirc;t dans la console de la vue <span class="emphasis"><strong>Run</strong></span>. L'it&eacute;ration se termine imm&eacute;diatement et est suivie d'un
                        autre message affichant l'heure de fin de la boucle it&eacute;rative et le nombre
                        d'it&eacute;rations effectu&eacute;es.</p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d84597e561337"></a>Sc&eacute;nario 2 : Attendre la cr&eacute;ation d'un fichier et poursuivre l'it&eacute;ration apr&egrave;s le
            d&eacute;clenchement d'un message</h3></div></div></div><p>Bas&eacute; sur le sc&eacute;nario pr&eacute;c&eacute;dent, ce sc&eacute;nario d&eacute;crit un Job d&eacute;clenchant un message dans
            la console ainsi que la cr&eacute;ation d'un fichier texte dans le r&eacute;pertoire scann&eacute;, sans
            arr&ecirc;ter le processus de scan imm&eacute;diatement. Le Job continue &agrave; scanner le r&eacute;pertoire
            jusqu'&agrave; ce que le nombre d'it&eacute;rations atteigne la valeur maximale d&eacute;finie.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Double-cliquez sur le <span class="emphasis"><strong>tWaitForFile</strong></span> pour
                    ouvrir sa vue <span class="emphasis"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/Use_Case_tWaitForFile5.png"></div></li><li class="step"><p>Dans le champ <span class="emphasis"><strong>Time (in seconds) between
                        iterations</strong></span>, saisissez l'intervalle de temps en secondes entre
                    deux it&eacute;rations. Dans cet exemple, saisissez <span class="emphasis"><em>5</em></span>.</p></li><li class="step"><p>Dans le champ <span class="emphasis"><strong>Max. number of iterations (infinite loop
                        if empty)</strong></span>, saisissez le nombre maximal d'it&eacute;rations. Dans cet
                    exemple, saisissez <span class="emphasis"><em>10</em></span>.</p></li><li class="step"><p>Dans la liste <span class="emphasis"><strong>Then</strong></span>, s&eacute;lectionnez <span class="emphasis"><strong>continue loop</strong></span> afin de continuer la boucle it&eacute;rative,
                    m&ecirc;me apr&egrave;s d&eacute;clenchement du message.</p></li><li class="step"><p>Appuyez sur les touches <span class="emphasis"><strong>Ctrl+S</strong></span> afin de
                    sauvegarder le Job.</p></li><li class="step"><p>Appuyez sur <span class="emphasis"><strong>F6</strong></span> pour ex&eacute;cuter le Job.</p></li><li class="step"><p>Cr&eacute;ez un fichier texte <span class="emphasis"><em>continue.txt</em></span> dans le
                    r&eacute;pertoire sp&eacute;cifi&eacute;.</p><div class="mediaobject"><img src="../images/Use_Case_tWaitForFile6.png"></div><p>Lorsqu'un fichier texte est cr&eacute;&eacute;, un message concernant la cr&eacute;ation du fichier
                    est affich&eacute; dans la console de la vue <span class="emphasis"><strong>Run</strong></span>. La
                    boucle it&eacute;rative est arr&ecirc;t&eacute;e jusqu'&agrave; ce que le nombre d'it&eacute;rations atteigne dix.
                    Un nouveau message s'affiche et indique l'heure de fin de la boucle it&eacute;rative et
                    le nombre d'it&eacute;rations effectu&eacute;es.</p></li></ol></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tSleep.html">Pr&eacute;c&eacute;dent</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch-orchestration.html">Niveau sup&eacute;rieur</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="tWaitForSocket.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">tSleep&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="bk-components-rg-fr..html">Sommaire</a></td><td width="40%" align="right" valign="top">&nbsp;tWaitForSocket</td></tr></table></div></body></html>