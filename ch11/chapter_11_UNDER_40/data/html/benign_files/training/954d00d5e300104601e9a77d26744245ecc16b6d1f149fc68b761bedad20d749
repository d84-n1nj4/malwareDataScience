<!DOCTYPE HTML>
<html i18n-values="dir:textdirection;">
<head>
  <meta charset="utf-8">
  <title i18n-content="crashesTitle"></title>
  <style>body {
  margin: 20px;
}

h1 {
  -webkit-padding-start: 75px;
  /* TODO(stuartmorgan): Get real art for this image */
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCAgMAAACeOuh7AAAABGdBTUEAAK/INwWK6QAAAAlQTFRF////AAAA////fu+PTwAAAAF0Uk5TAEDm2GYAAACHSURBVDjLxdLbDYAgDAVQGELn0R3oEHYf2KGdUqtE46OFRCP3oyTng1xCnWsaD5JRRtCkQ2YmkBkHRXqWJBn0j0TICbrsWVoWhRShCdcGyZCtHxMaUnVPRZ9KSbmBJdsX2vJVnwqRD0Rb4rpzgIbE/AI5NTnWAMvy5l0dXrfuLh5OCe5BmmYGXhTUxlQ5xJ8AAAAASUVORK5CYII=");
  background-position: left;
  background-repeat: no-repeat;
  font-size: 156%;
  font-weight: bold;
  margin: 0;
  padding-bottom: 20px;
  padding-top: 20px;
}

html[dir=rtl] h1 {
  background-position: right;
}

#countBanner {
  background-color: #ebeffa;
  border: 1px solid #bbb;
  border-radius: 2px;
  font-size: 100%;
  padding: 4px;
}

#crashList h3 {
  font-size: 100%;
}

#crashList > div > * {
  margin: 0.75em 0;
}

#crashList a:visited {
  color: #666;
}

#crashList > div:not(:last-child) {
  border-bottom: 1px solid #bbb;
}

#disabledMode h2 {
  color: #8d332a;
  font-size: 125%;
}
</style>
  <script src="chrome://resources/js/local_strings.js"></script>
  <script src="chrome://resources/js/util.js"></script>
  <script>// Copyright (c) 2011 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

localStrings = new LocalStrings();

/**
 * Requests the list of crashes from the backend.
 */
function requestCrashes() {
  chrome.send('requestCrashList', [])
}

/**
 * Callback from backend with the list of crashes. Builds the UI.
 * @param {boolean} enabled Whether or not crash reporting is enabled.
 * @param {array} crashes The list of crashes.
 */
function updateCrashList(enabled, crashes) {
  $('countBanner').textContent = localStrings.getStringF('crashCountFormat',
                                                         crashes.length);

  var crashSection = $('crashList');

  $('enabledMode').hidden = !enabled;
  $('disabledMode').hidden = enabled;

  if (!enabled)
    return;

  // Clear any previous list.
  crashSection.textContent = '';

  for (var i = 0; i < crashes.length; i++) {
    var crash = crashes[i];

    var crashBlock = document.createElement('div');
    var title = document.createElement('h3');
    title.textContent = localStrings.getStringF('crashHeaderFormat',
                                                crash['id']);
    crashBlock.appendChild(title);
    var date = document.createElement('p');
    date.textContent = localStrings.getStringF('crashTimeFormat',
                                               crash['time']);
    crashBlock.appendChild(date);
    var linkBlock = document.createElement('p');
    var link = document.createElement('a');
    link.href = 'http://code.google.com/p/chromium/issues/entry?' +
        'comment=URL%20(if%20applicable)%20where%20crash%20occurred:%20%0A%0A' +
        'What%20steps%20will%20reproduce%20this%20crash?%0A1.%0A2.%0A3.%0A%0A' +
        '****DO%20NOT%20CHANGE%20BELOW%20THIS%20LINE****%0Areport_id:' +
        crash['id'];
    link.target = '_blank';
    link.textContent = localStrings.getString('bugLinkText');
    linkBlock.appendChild(link);
    crashBlock.appendChild(linkBlock);
    crashSection.appendChild(crashBlock);
  }

  $('noCrashes').hidden = crashes.length != 0;
}

document.addEventListener('DOMContentLoaded', requestCrashes);
</script>
</head>
<body i18n-values=".style.fontFamily:fontfamily;.style.fontSize:fontsize">
  <header><h1 i18n-content="crashesTitle"></h1></header>
  <div id="enabledMode">
    <h2 id="countBanner"></h2>
    <div id="crashList"></div>
    <p id="noCrashes" i18n-content="noCrashesMessage" hidden></p>
  </div>
  <div id="disabledMode" hidden>
    <h2 i18n-content="disabledHeader"></h2>
    <p i18n-values=".innerHTML:disabledMessage"></p>
  </div>
</body>
</html>
