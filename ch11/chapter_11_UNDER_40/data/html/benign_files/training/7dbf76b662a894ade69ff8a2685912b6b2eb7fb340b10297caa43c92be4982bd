
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>eParcel - Login</title>
		
		<meta http-equiv="Pragma" content="no-cache"> 
		<meta http-equiv="Cache-control" content="no-store">
		<meta http-equiv="Expires" content="-1">
		
		<meta name="description" content="description">
		<meta name="author" content="metabox">
		<meta name="keyword" content="keywords">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="/plugins/bootstrap/bootstrap.css" rel="stylesheet">
		<link href="/css/font-awesome.css" rel="stylesheet">
		<link href="/css/google.font.righteous.css" rel="stylesheet" type="text/css">
		<link href="/css/style.css" rel="stylesheet">
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
				<script src="/js/html5shiv.js"></script>
				<script src="/js/respond.min.js"></script>
		<![endif]-->
		
		<script src="/plugins/jquery/jquery-2.1.0.min.js"></script>
		<script src="/js/jquery.cookie.js"></script>
		<script src="/js/common.js"></script>
		
		
	</head>
<body>
<div class="container-fluid">
	<div id="page-login" class="row">
		<div class="col-xs-12 col-md-4 col-md-offset-4 col-sm-6 col-sm-offset-3">
			
			<div class="box">
				<div class="box-content">
					<div class="text-center">
						<h3 class="page-header">eParcel Member Login</h3>
					</div>
					<div class="form-group">
						<label class="control-label">E-mail</label>
						<input type="text" class="form-control" name="useremail" id="useremail" />
					</div>
					<div class="form-group">
						<label class="control-label">Password</label>
						<input type="password" class="form-control" name="password" id="userpassword" />
					</div>
					
					
					<div class="checkbox">
						<label>
							<input type="checkbox" id="is_remember_useremail" value="1" checked> Remember E-mail
								<i class="fa fa-square-o small"></i>
						</label>
					</div>
					
					
					<div class="text-center">
						<a href="#" id="btn_submit" class="btn btn-primary">Login</a>
					</div>
					
					
					<div class="text-right">
						<a href="/register">Need an account?</a>
					</div>
					
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">

		
function login() {
	var params = {};
	params.user_email = $("#useremail").val();
	params.user_passwd = $("#userpassword").val();
	params.is_remember_useremail = $("#is_remember_useremail").val();
	$.ajax({
		url:"/api/login",
		type:"post",
		data:params,
		dataType:"json",
		beforeSend:function() {
//			indicator(1);
		},
		success:function(res) {
			if (res.ack=="success") {
				if(params.is_remember_useremail == "1") {
					$.cookie("remember_useremail",params.user_email,{expires:30,path:"/"});
				}
				if(typeof(res.items)!="undefined" && res.items=="not verified") {
					parent.location.href="/dashboard?nb=1";
				}
				else {
					if(typeof($_GET["r"])!="undefined" && $_GET["r"]!="") {
						parent.location.href=$_GET["r"];
					} 
					else {
						parent.location.href="/dashboard";
					}
				}		
			} 
			else if (res.ack=="error") {
				if(typeof(res.message)!="undefined") {
					alert(res.message);
				}
			}
			res = null;
		},
		error:function(e) {
			if(e.responseText) {
				alert(e.responseText);
			}
		}
	}).done(function(){
//		indicator();
	});
}

function login_check() {
	if(!$("#useremail").val()) {
		alert("E-mail is required");
		$("#useremail").focus();
		return false;
	}
	else if(!$("#userpassword").val()) {
		alert("Password is required");
		$("#userpassword").focus();
		return false;
	}
	else {
		login();
	}
}

$(document).ready(function() {



	
	if($.cookie("remember_useremail")) {
		$("#is_remember_useremail").prop("checked",true);
		$("#useremail").val($.cookie("remember_useremail"));
		$("#userpassword").focus();
	} else {
		//$("#is_remember_useremail").prop("checked",false);
		$("#useremail").focus();
	}


	$("#btn_submit").click(function() {
		login_check();		
	});

	$("#useremail,#userpassword").on("keypress",function(e) {
		if(e.keyCode == 13) {
			login_check();
		}
	});
});

</script>

</body>
</html>